{% extends 'layout.html' %}
{% load staticfiles %}

{% block extrastyles %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static "options/css/styles.css" %}" />
<style type="text/css">
.table-striped tbody > tr:nth-child(odd) > td, .table-striped tbody > tr:nth-child(odd) > th {
background-color: #f9f9f9;
}
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="set-size-grid clearfix">
  <div class="wizard-progress">
    <ul>
      <li><strong>Select Options</strong></li>
      <li>Get Quote</li>
      <li>Upload Files</li>
    </ul>
  </div>
  <h2>Select {{ product }}  Options</h2>
</div>
{% endblock %}
{% block content %}

<div id="title-target" class="center-block clearfix"></div>

<div class="clearfix stepy-centering">

<div id="form-errors" class="grid-7 float-left option-choice-errors">
{% if errors %}
<ul>
{% for error in errors %}
<li><strong>{{ error }}</strong></li>
{% endfor %}
</ul>
{% endif %}
</div>

  <table id="selected-choices" class="grid-3 float-right table-striped">
    <thead>
      <tr>
        <th>Selected Choices</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

<form id="pickoptions" method="POST" class="grid-7 float-left">{% csrf_token %}

    {% for group in groups %}

    <fieldset title="{{ group.group.name }}">
      <br />
      <div class="grid-7 float-left">
        <ul class="options-group">
            {% for picker in group.pickers %}
            <li>
                <h3 class="option-title">&nbsp;&nbsp;{{ picker.picker.option }}</h3>

                <div id="choice-{{ picker.picker.option.code }}-errors" class="option-choice-errors">
                  {% if picker.form.choice_errors %}
                  <ul>
                    {% for error in picker.form.choice_errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                  </ul>
                  {% endif %}
                </div>

                {% for field in picker.form.visible_fields %}
                {% if picker.picker.widget == picker.picker.THUMBNAIL %}
                <div class="option-choice grid-7">
                  <ul id="carousel-{{ picker.picker.id }}" class="jcarousel-skin-tango grid-7">
                    {% for choice in field.field.queryset %}
                    <li>
                        {{ choice.caption }}<br />
                        <img src="{{ choice.get_thumbnail.url }}" alt="{{ choice.caption }}"/><br />
                        <input class="radio-choice" type="radio" name="{{ field.name }}" value="{{ choice.pk }}"
                          {% ifequal field.data|slugify choice.pk|slugify %}
                             checked="checked"
                          {% endifequal %} />
                    </li>
                    {% endfor %}
                  </ul>
                </div>
                <script type="text/javascript">
                $( document ).ready(function(){
                  $('#carousel-{{ picker.picker.id }}').jcarousel({
                    vertical: false, 
                    wrap: 'last',
                    itemFallbackDimension: 376,
                  });
                });
                </script>
                {% endif %}

                {% if picker.picker.widget == picker.picker.DROPDOWN %}
                <div class="option-choice">
                  {{ field }}
                </div>
                {% endif %}

                {% endfor %}
            </li>
            {% endfor %}
        </ul>
      </div>
    </fieldset>
    {% endfor %}

    <input value="Get Quote" type="submit" class="finish button"/>
</form>
</div>
<script type="text/javascript">
$(document).ready(function(){
  $('#pickoptions').stepy({
    legend:false,
    titleTarget: '#title-target',
    description: false,
    validate: false
  });

  $('.options-group .option-choice').hide();
  $('.options-group > li:first-child').find('.option-choice').show();

  $('.option-title').click(function(){
    $(this).parent().parent().find('.option-choice').hide('slow');
    $(this).parent().find('.option-choice').show('slow');
  });

  $('.option-choice .radio-choice').click(function(){
    $(this).closest('.option-choice').hide('slow');
    $(this).closest('.option-choice').parent().next().find('.option-choice').show('slow');
    $('#selected-choices tbody').html('');
    $('.option-choice .radio-choice:checked').each(function(a,b){
      $('#selected-choices tbody').append('<tr><td>' + $(b).closest('li').html()  + '</td></tr>')  
    });
  });

  $('.jcarousel-skin-tango').hover(function(){
    $(this).find('.jcarousel-prev-horizontal').css({'background-position': '0 -50px'});
    $(this).find('.jcarousel-next-horizontal').css({'background-position': '0 0px'});
  }, function(){
    $(this).find('.jcarousel-prev-horizontal').css({'background-position': '0 50px'});
    $(this).find('.jcarousel-next-horizontal').css({'background-position': '0 50px'});
  });
});
</script>
{% endblock %}