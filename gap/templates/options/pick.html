{% extends 'catalogue/detail.html' %}
{% load staticfiles %}
{% block content %}

<div class="container-fluid">
  <div class="row">
  <div class="flexslider">
    <ul class="slides">
         <li>
            <article>
                <div class="media">
                  <div class="visible-xs">
                    <h3 class="media-heading text-center">{{ product.title }}</h3>
                    <h4 class="text-center">Prices from £15 for 600 flyers</h4>
                    <a href="#">
                      <img class="media-object" src="{% static "local/images/product.jpg" %}" alt="Image">
                    </a>
                    <div class="media-body">
                      <h3 class="media-heading hidden-xs">{{ product.title }}</h3>
                      <h4 class="hidden-xs">Prices from £15 for 600 flyers</h4>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
                    </div>
                  </div>

                  <div class="hidden-xs">
                    <a class="pull-left" href="#">
                      <img class="media-object" src="{% static "local/images/product.jpg" %}" alt="Image">
                    </a>
                    <div class="media-body">
                      <h3 class="media-heading hidden-xs">{{ product.title }}</h3>
                      <h4>Prices from £15 for 600 flyers</h4>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
                                </div>
                              </div>
                            </div>
                        </article>
                    </li>
                   <li>
                        <article>
                <div class="media">
                  <div class="visible-xs">
                    <h3 class="media-heading text-center">{{ product.title }}</h3>
                    <h4 class="text-center">{{ product.title }}</h4>
                    <a href="#">
                      <img class="media-object" src="{% static "local/images/product.jpg" %}" alt="Image">
                    </a>
                    <div class="media-body">
                      <h3 class="media-heading hidden-xs">{{ product.title }}</h3>
                      <h4 class="hidden-xs">Prices from £15 for 600 flyers</h4>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
                    </div>
                  </div>

              <div class="hidden-xs">
                    <a class="pull-left" href="#">
                      <img class="media-object" src="{% static "local/images/product.jpg" %}" alt="Image">
                    </a>
                    <div class="media-body">
                      <h3 class="media-heading hidden-xs">{{ product.title }}</h3>
                      <h4>Prices from £15 for 600 flyers</h4>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
                    </div>
                  </div>
                </div>
            </article>
        </li>
    </ul>
</div>

<div class="clearfix"></div>



<div id="title-target" class="center-block clearfix"></div>

<div class="clearfix stepy-centering">

<div id="form-errors" class="grid-7 float-left option-choice-errors">
{% if errors %}
<ul>
{% for error in errors %}
<li><strong>{{ error }}</strong></li>
{% endfor %}
</ul>
{% endif %}
</div>

<script>
  AllChoices = new Object ();
  var disableConflictingChoices =function()
  {
    choice_value = $(this).val()*1;
    conflicts = AllChoices[choice_value].conflicts_with;
    $(":input:disabled").removeAttr("disabled");
    if (conflicts.length > 0) {
      for (var i = 0; i < conflicts.length; i++) {
        $(":input[value='" + conflicts[i] + "']").attr('disabled', true);
      }
    }
  };
  
</script>

<form id="pickoptions" method="POST">
{% csrf_token %}
  <div class="panel-group" id="product-accordion">
  {% for group in groups %} 
   <h3 class="button group_name">{{ group.group.name }}</h3>        
  {% for picker in group.pickers %}

  <div class="panel panel-default">
          <a data-toggle="collapse" href="#panel-collapse-{{ picker.picker.option.pk }}" class="panel-heading collapsed" data-parent="#product-accordion">{{ picker.picker.option }}</a>
          <div id="panel-collapse-{{ picker.picker.option.pk }}" class="panel-collapse collapse {% if forloop.first and forloop.parentloop.first %}in{% endif %}">
            <div class="panel-body">
              <div class="text-right">
                <span class="info" data-container="body" data-toggle="popover" data-placement="left" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus."><img src="{% static "local/images/infoblue.png" %}" /></span>
              </div>
              {% for field in picker.form.visible_fields %}
                {% if picker.picker.widget == picker.picker.THUMBNAIL %}
                <div class="option-choice grid-7">
                  <ul class="list-inline">
                    {% for choice in field.field.queryset %}
                      <script type="text/javascript">
                        
                        var choice = new Object();
                        choice.optioncode = "{{ choice.option.code }}";
                        choice.optioncaption = "{{ choice.option.name }}";
                        choice.code = "{{ choice.code }}";
                        choice.caption = "{{ choice.caption }}";
                        choice.conflicts_with = new Array();
                        {% for conflicting_choice in choice.conflicts_with.all %}
                        choice.conflicts_with.push({{ conflicting_choice.pk }});
                        {% endfor %}
                        AllChoices[{{ choice.pk }}] = choice;
                      </script>
                      <li>
                          {{ choice.caption }}<br />
                          <label for="{{ field.name }}_{{ choice.pk }}">
                          <img src="{{ choice.get_thumbnail.url }}" alt="{{ choice.caption }}"/><br />
                          <input class="radio-choice" type="radio" name="{{ field.name }}" value="{{ choice.pk }}"
                            {% ifequal field.data|slugify choice.pk|slugify %}
                               checked="checked"
                            {% endifequal %} id ="{{ field.name }}_{{ choice.pk }}"/>
                           </label>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
                {% endif %}
                {% if picker.picker.widget == picker.picker.DROPDOWN %}
                <div class="option-choice">
                  {{ field }}
                </div>
                {% endif %}
          {% endfor %}
        </div>
    </div>
  </div>
  {% endfor %}
  {% endfor %}
  </form>

<div id="modalchangepw">
</div>

  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){

var calculared =false;

$.ajax({
  data: $('form#pickoptions').serialize(),
  type: $('form#pickoptions').attr('method'),
  url: $('form#pickoptions').attr('action'),
  success: function(response) {
    x = $('<div></div>');
    x.html(response);
    res = x.find('#getquote_wrap');
    $('#modalchangepw').html(res);
  }
});

$('.panel-default:last .option-choice .radio-choice').click(function (){
  $.ajax({
      data: $('form#pickoptions').serialize(),
      type: $('form#pickoptions').attr('method'),
      url: $('form#pickoptions').attr('action'),
      success: function(response) {
        x = $('<div></div>');
        x.html(response);
        res = x.find('#getquote_wrap');
        $('#modalchangepw').html(res);
      }
  });
  calculared = true;
  return false;
});

  $('.option-choice .radio-choice').click(function(){
    if (calculared) {
      var quantity = $('#getquote li input:checked').attr('value');
      $.ajax({
        data: $('form#pickoptions').serialize(),
        type: $('form#pickoptions').attr('method'),
        url: $('form#pickoptions').attr('action'),
        success: function(response) {
          x = $('<div></div>');
          x.html(response);
          res = x.find('#getquote_wrap');
          $('#modalchangepw').html(res);
          $('li[data-qty="'+quantity+'"]').trigger("click");
        },
      });
    }
    prev = $(this).first().closest('.panel-collapse');
    prev.collapse('toggle');
    next = prev.parent('.panel').next();
    if (next.hasClass('group_name')) next = next.next().children('.panel-collapse');
    else next = next.children('.panel-collapse');
    next.collapse('show');
    $('#selected-choices ul').html('');
    $('.option-choice .radio-choice:checked').each(function(a,b){
        $('#selected-choices ul').append('<li>' + $(b).closest('li').html()  + '</li>')
    });
  });  
  
  $(".radio-choice").click(disableConflictingChoices);

  $('input.radio-choice').attr("checked", false);

});
</script>
</div>
</div>

{% endblock %}
