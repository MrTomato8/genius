{% extends 'layout.html' %}
{% load url from future %}
{% load staticfiles %}
{% load currency_filters %}

{% block extrastyles %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static "options/css/styles.css" %}" />
{% endblock %}

{% block breadcrumbs %}
<div class="set-size-grid clearfix">
  <div class="wizard-progress">
    <ul>
      <li><a href="{%url 'options:pick' pk=params.pk product_slug=params.product_slug %}">Select Options</a></li>
      <li><strong>Get Quote</strong></li>
      <li>Upload Files</li>
    </ul>
  </div>
  <h2>Get Quote</h2>
</div>
{% endblock %}

{% block content %}
<div class="clearfix center-block">

  <div class="grid-4 float-left choice-list">
  <h3>{{ product }}</h3>
  <ul>
  {% for choice in choices %}
  <li>{{ choice.caption }}<br /><img src="{% static choice.get_thumbnail.name %}" alt="{{ choice.option }}"/></li>
  {% endfor %}
  </ul>
  </div>
  
  <div class="grid-4 float-left price-calculator">
    <form id="getquote" method="POST">{% csrf_token %}
      <table>
        <tr>
          <th style="width: 160px;">Quantity</th>
          <th>
            {% if trade_user %}
            Trade Price
            {% else %}
            Price
            {% endif %}
          </th>
        </tr>
        {% if discrete_pricing %}
        {% for qty, price in prices.items %}
        <tr>
          <td><input type="radio" id="quantity_{{ qty }}" name="quantity" value="{{ qty }}" 
          {% ifequal calc_form.quantity.data|slugify qty|slugify %}
          checked="checked"
          {% endifequal %} />
          <label for="quantity_{{ qty }}">{{ qty|floatformat }}</label></td>
          <td>
            {% if trade_user %}
            {{ price.tpl_price_incl_tax|currency }}
            {% else %}
            {{ price.rpl_price_incl_tax|currency }}
            {% endif %}
          </td>
        </tr>
        {% endfor %}
        {% else %}
        {% with prices.values|first as price %}
        <tr>
          <td>{{ calc_form.quantity }}</td>
          <td>
            {% if trade_user %}
            {{ price.tpl_price_incl_tax|currency }}
            {% else %}
            {{ price.rpl_price_incl_tax|currency }}
            {% endif %}
          </td>
        </tr>
        {% endwith %}
        {% endif %}
      </table>

      {% if custom_size %}
      <div class="custom_size">
        <h3>Custom Size:</h3>
        <div class="custom-size-columns">
          <div>
            {{ custom_size_form.width.errors }}
            <label for="width">Width (mm):</label><br />
            {{ custom_size_form.width }}
          </div>
          <div>
            {{ custom_size_form.height.errors }}
            <label for="height">Height (mm):</label><br />
            {{ custom_size_form.height }}
          </div>
        </div>
      </div>
      {% endif %}

      <div id="form-errors" class="quote-errors">
        {% if errors %}
        <ul>
        {% for error in errors %}
        <li><strong>{{ error }}</strong></li>
        {% endfor %}
        </ul>
        {% endif %}
      </div>

      <div class="options-calculate">
        <input value="Get Quote" type="submit" class="button"/>
      </div>

    </form>
  </div>


  {% if quote.valid %}
  <div class="grid-7 float-left options-quote">
    <h2>
      {{ quote.price|currency }}
      for
      {{ quote.quantity }} unit(s) of {{ product }} with following options:</h2>
    <ul>
    {% for choice in choices %}
      <li>{{ choice.option }} {{ choice.caption }}</li>
    {% endfor %}
    </ul>
    {% if custom_size %}
    Custom size is {{ quote.choice_data_custom_size.width }}(mm) x {{ quote.choice_data_custom_size.height }}(mm)
    {% endif %}
  </div>

  <div class="grid-2 float-left options-next">
    <form id="next" method="GET" action="{%url 'options:upload' pk=params.pk product_slug=params.product_slug %}">
      <input value="Proceed" type="submit" class="finish button"/>
    </form>
  </div>
  {% endif %}    

</div>
{% endblock %}