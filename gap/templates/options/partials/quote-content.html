{% load url from future %}
{% load staticfiles %}
{% load currency_filters %}
{% load simple_math %}
{% load humanize %}

<div id="getquote_wrap">
<script type="text/javascript">
$(document).ready(function(){
  $('#getquote li').click(function(){
    if ($(this).data('type')=='2') price = $(this).data('price');
    else price = $(this).data('price') + ' for each';
      $('#calculated_price').html(price);
      $('#quantity_'+$(this).data('qty')).prop('checked', true);
  });
  $('#buy_button').click(function(){
      $('#getquote').submit();
  });

});
</script>

<form id="getquote" method="POST" action="{%url 'options:quote' pk=params.pk product_slug=params.product_slug %}">{% csrf_token %}
<div class="panel panel-default">
<a data-toggle="collapse" href="#panel-collapse-6" class="panel-heading  collapsed" data-parent="#product-accordion">Quantity (choose quantity or enter your own)</a>
  <div id="panel-collapse-6" class="panel-collapse collapse in">
    <div class="panel-body">
      <div class="text-right">
          <span class="info" data-container="body" data-toggle="popover" data-placement="left" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus."><img src="{% static "local/images/infoblue.png" %}" /></span>
      </div>
      <div class="row">
          {% if prices.discrete_pricing and prices.matrix_for_pack %}
            {% with prices.values|last as price %}
              {% with quote.quantity|divide_int:price.items_per_pack|int_multiply:price.items_per_pack as quantity %}
               <li data-type="1" data-price="{{quote.price|divide_triple:quantity}}">{{ calc_form.quantity }} £{{quote.price|divide_triple:quantity}} each</li>
              {% endwith %}
            {% endwith %}
          {% elif prices.discrete_pricing %}
          <div class="col-md-2 col-sm-3 col-xs-6 text-center">
          <ul class="list-unstyled">
            {% with prices|length|divide_int_ceil:6 as divi %}
            {% for qty, price in prices.ordered.iteritems %}
            <li data-type="2" data-qty="{{qty}}" data-price="{% if trade_user %}{{ price.tpl_price_incl_tax|currency }}{% else %}{{ price.rpl_price_incl_tax|currency }}{% endif %}">{{ qty|floatformat }}
            <input type="radio" id="quantity_{{ qty }}" name="quantity" value="{{ qty }}" style="display:none" />
            {% if not forloop.counter|mod:divi %}
            </ul>
            </div>
            <div class="col-md-2 col-sm-3 col-xs-6 text-center">
            <ul class="list-unstyled">
            {% endif %}
            {% endfor %}
            {% endwith %}
          {% else %}
          {% with prices.values|first as price %}
          <li data-type="3" data-price="{% if trade_user %}{{ price.tpl_price_incl_tax|currency }}{% else %}{{ price.rpl_price_incl_tax|currency }}{% endif %}">{{ calc_form.quantity }} 
          {% if trade_user %}
            {{ price.tpl_price_incl_tax|currency }}
            {% else %}
            {{ price.rpl_price_incl_tax|currency }}
            {% endif %}
          </li>
          {% endwith %}
          {% endif %}
      </div>
    </div>
  </div>
</div>
  
  
      {% if custom_size %}
      <div class="custom_size">
        <h3>Custom Size:</h3>
        <div class="custom-size-columns">
          <div>
            {{ custom_size_form.width.errors }}
            <label for="width">Width (mm):</label><br />
            {{ custom_size_form.width }}
          </div>
          <div>
            {{ custom_size_form.height.errors }}
            <label for="height">Height (mm):</label><br />
            {{ custom_size_form.height }}
          </div>
        </div>
      </div>
      {% endif %}

      <div id="form-errors" class="quote-errors">
        {% if errors %}
        <ul>
        {% for error in errors %}
        <li><strong>{{ error }}</strong></li>
        {% endfor %}
        </ul>
        {% endif %}
      </div>
    </form>

      <div class="row">
      <div class="col-md-4">
        <span class="toggle-live" onclick="$(this).toggleClass('active'); $('#product-quantity-inputs, #product-table-wrap').slideToggle();"> Multi-file discount </span>
        <span class="info" data-container="body" data-toggle="popover" data-placement="right" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus."><img src="{% static "local/images/infoblue.png" %}" /></span>
      </div>
      <div class="col-md-8">
        <form action="#" class="form-horizontal" >
          <div class="form-group">
            <label class="col-sm-8 col-xs-12 control-label">Choose or enter quantity for each</label>
            <div class="col-sm-4 col-xs-12">
              <div class="input-group">
                <input type="text" class="form-control" />
                <span class="input-group-btn"><button class="btn btn-primary"><span class="fa fa-angle-right"></span></button>
              </div>
            </div>
          </div>
          <div id="product-quantity-inputs"  style="display:none;">
              <div class="form-group">
                <label class="col-sm-8 col-xs-12 control-label">Number of files</label>
                <div class="col-sm-4 col-xs-12">
                  <div class="input-group">
                    <input type="text" class="form-control" />
                    <span class="input-group-btn btn-group-vertical">
                      <button class="btn btn-default"><span class="fa fa-angle-up"></span></button>
                      <button class="btn btn-default"><span class="fa fa-angle-down"></span></button>
                    </span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-8 col-xs-12 control-label">Total quantity</label>
                <div class="col-sm-4 col-xs-12">
                  <div class="input-group">
                    <input type="text" class="form-control" />
                    <span class="input-group-btn"><button class="btn btn-primary"><span class="fa fa-angle-right"></span></button>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <div class="col-sm-4 col-xs-12 col-sm-offset-8">
                  <button class="btn btn-primary btn-block">Add <span class="fa fa-angle-down"></span></button>
                </div>
              </div>
          </div>
        </form>
      </div>
    </div>

  {% if quote.valid %}
  <div class="grid-7 float-left">
    <div class="options-quote">
      <h2>
      	{{quote.quantity|intcomma  }} {{product}} at {{quote.price|currency}} (exl. tax), with the following options: 
      	
      	{% comment %}
      	{% if prices.matrix_for_pack %}
      		
      		starting from
      		
      		{% if trade_user %}
      			{% with vanilla_price=prices.get_min_tpl_price %}
      				£{{ vanilla_price.price|divide_triple:vanilla_price.items_per_pack }}
      			{% endwith %}
      		{% else %}
      			{% with vanilla_price=prices.get_min_rpl_price %}
					{{ vanilla_price.price|divide_triple:vanilla_price.items_per_pack }}
				{% endwith %}
      		{% endif %}
      		 each, with following options:
      	{% else %}
      			{{ quote.price|currency}} for {{ quote.quantity }} {{product}},
      			with the following options: 
      	{% endif %}
      	{% endcomment %}
        </h2>
      <ul >
      {% for choice in choices %}
        <li><p class="medium"><b> <i class="icon-level-up"></i> {{ choice.option }}</b> {{ choice.caption }}</p></li>
      {% endfor %}
      </ul>
      {% if custom_size %}
      Custom size is {{ choice_data_custom_size.width }}(mm) x {{ choice_data_custom_size.height }}(mm)
      {% endif %}
      <p class="medium-large"><i class="icon-warning-sign"></i> <span class="boxed">Price per {{product}} can change with quantity</span></p>
    </div>

    <div class="options-next">
      <form id="quote-save" method="POST" action="{%url 'options:quote-save' pk=params.pk product_slug=params.product_slug %}">{% csrf_token %}
        <input value="Proceed" type="submit" class="finish button"/>
        {{ quote_save_form }}
      </form>
    </div>
  </div>  
  {% endif %} 

</div>   
