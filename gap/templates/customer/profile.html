{% extends "layout_2_col.html" %}
{% load currency_filters %}
{% load i18n %}

{% block title %}
{% trans 'My account' %} | {{ block.super }}
{% endblock %}

{% block body_class %}account-profile{% endblock %}

{% block breadcrumbs %}
<div class="set-size-grid">
    <a href="{% url promotions:home %}">{% trans 'Home' %}</a>
    <span class="divider">/</span>
    <a href="#">{% trans 'Account' %}</a>
    <h2>{% trans 'Account' %}</h2>
<div>
{% endblock %}

{% block headertext %}{% endblock %}

{% block column_left %}
<div class="sidebar-left">
    <div class="panel panel-primary">
        <a class="panel-heading" data-toggle="collapse" href="#panel-category-1">Account</a>
        <div class="panel-body panel-collapse collapse in" id="panel-category-1">
            <ul class="list-unstyled">
                <li><a href="#profile">{% trans 'Profile' %}</a></li>
                <li><a href="#orders">{% trans 'Order History' %}</a></li>
                <li><a href="#addresses">{% trans 'Address Book' %}</a></li>
                <li><a href="#emails">{% trans 'Email History' %}</a></li>
                <li><a href="#alerts">{% trans "Alerts" %}</a></li>
                <li><a href="#saved_quotes">{% trans "Saved Quotes" %}</a></li>
                {% block extra_tabs_nav %}{% endblock %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div>
    <div class="tab-pane {% if active_tab == 'profile' %}active{% endif %}" id="profile">
        {% block tab_profile %}
        <div class="sub-header">
            <h3>{% trans 'Profile' %}</h3>
        </div>
        <table class="table table-striped table-bordered">
            <tbody>
                <tr>
                    <td>{% trans 'Name' %}</td>
                    <td>{{ request.user.get_full_name|default:'-' }}</td>
                </tr>
                <tr>
                    <td>{% trans 'Email address' %}</td>
                    <td>{{ user.email }}</td>
                </tr>
                {% block profile_fields %}
                {% for field in profile_fields %}
                <tr>
                    <td>{{ field.name }}</td>
                    <td>{{ field.value|default:"-" }}</td>
                </tr>
                {% endfor %}
                {% endblock %}
                <tr>
                    <td>{% trans 'Date registered' %}</td>
                    <td>{{ user.date_joined }}</td>
                </tr>
            </tbody>
        </table>

        <div class="form-actions">
            <a href="{% url customer:profile-update %}" class="btn btn-primary">{% trans 'Edit profile' %}</a>
            <a href="{% url customer:change-password %}" class="btn btn-danger">{% trans 'Change password' %}</a>
        </div>
        {% endblock %}
    </div>

    <div class="tab-pane {% if active_tab == 'orders' %}active{% endif %}" id="orders">
        {% block tab_orderhistory %}
        <div class="sub-header">
            <h3>{% trans 'Order history' %}</h3>
        </div>

        {% if orders %}
        <table class="table table-striped table-bordered">
            <tr>
                <th>{% trans 'Order number' %}</th>
                <th>{% trans 'Total inc tax' %}</th>
                <th>{% trans 'Date submitted' %}</th>
                <th></th>
            </tr>
            {% for order in orders %}
            <tr>
                <td>{{ order.number }}</td>
                <td>{{ order.total_incl_tax|currency }}</td>
                <td>{{ order.date_placed }}</td>
                <td>
                    <a class="btn btn-info" href="{% url customer:order order.number %}">{% trans 'View' %}</a>
                    <form action="{% url customer:order order.number %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="order_id" value="{{ order.id }}" />
                        <input type="hidden" name="action" value="reorder" />
                        <button type="submit" class="btn btn-success">{% trans 'Re-order' %}</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>

        <div class="form-actions">
            <a href="{% url customer:order-list %}" class="btn btn-primary">{% trans 'View order history' %}</a>
        </div>
        {% else %}
        <p>{% trans "You haven't placed any orders yet." %}</p>
        {% endif %}
        {% endblock %}
    </div>

    <div class="tab-pane {% if active_tab == 'addresses' %}active{% endif %}" id="addresses">
        {% block tab_addressbook %}
        <div class="sub-header">
            <h3>{% trans "Address book" %}</h3>
        </div>
        <table class="table table-striped table-bordered">
            <tbody>
                <tr>
                    <td>{% trans 'Number of addresses in addressbook' %}</td>
                    <td>{{ addressbook_size }}</td>
                </tr>
                <tr>
                    <td>{% trans 'Default shipping address' %}</td>
                    <td>{{ default_shipping_address|default:"-" }}</td>
                </tr>
                <tr>
                    <td>{% trans 'Default billing address' %}</td>
                    <td>{{ default_billing_address|default:"-" }}</td>
                </tr>
            </tbody>
        </table>

        <div class="form-actions">
            <a href="{% url customer:address-list %}" class="btn btn-primary">{% trans 'Manage address book' %}</a>
        </div>

        {% endblock %}
    </div>

    <div class="tab-pane {% if active_tab == 'emails' %}active{% endif %}" id="emails">
        {% block tab_emailhistory %}
        <div class="sub-header">
            <h3>{% trans 'Email history' %}</h3>
        </div>
        {% if not emails %}

        <p>{% trans "You haven't been sent any emails yet." %}</p>

        {% else %}

        <table class="table table-striped table-bordered">
            <tr>
                <th>{% trans 'Date sent' %}</th>
                <th>{% trans 'Subject' %}</th>
                <th></th>
            </tr>
            {% for email in emails %}
            <tr>
                <td>{{ email.date_sent }}</td>
                <td>{{ email.subject }}</td>
                <td>
                    <a href="{% url customer:email-detail email.id %}" class="btn btn-info">{% trans 'View' %}</a>
                </td>
            </tr>
            {% endfor %}
        </table>

        <div class="form-actions">
            <a href="{% url customer:email-list %}" class="btn btn-primary">{% trans 'View email history' %}</a>
        </div>

        {% endif %}
        {% endblock %}
    </div>

    <div class="tab-pane {% if active_tab == 'alerts' %}active{% endif %}" id="alerts">
        {% block tab_alerts %}
        <div class="sub-header">
            <h3>{% trans "Alerts" %}</h3>
        </div>

        {% if not alerts %}
        <p>{% trans "You do not have any active alerts for out-of-stock products." %}</p>
        {% else %}
            <form action="." method="post" id="alerts_form">
            {% csrf_token %}
                <table class="table table-stiped table-bordered">
                    <tr>
                        <th>{% trans "Product" %}</th>
                        <th>{% trans "Status" %}</th>
                        <th>{% trans "Date created" %}</th>
                        <th></th>
                    </tr>

                    {% for alert in alerts %}
                    <tr>
                        <td>
                            {% with product=alert.product %}
                            <a href="{{ product.get_absolute_url }}">{{ product.get_title }}</a>
                            {% endwith %}
                        </td>
                        <td>{{ alert.status }}</td>
                        <td>{{ alert.date_created }}</td>
                        <td>
                            {% if alert.can_be_cancelled %}
                                <button class="btn btn-danger" type='submit' name='cancel_alert' value='{{ alert.id }}'>{% trans "Cancel" %}</button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </form>
        {% endif %}

        {% endblock %}
    </div>




    <div class="tab-pane {% if active_tab == 'saved_quotes' %}active{% endif %}" id="saved_quotes">
        {% block tab_saved_quotes %}
        <div class="sub-header">
            <h3>{% trans "Saved Quotes" %}</h3>
        </div>

        {% if not saved_quotes %}
        <p>{% trans "You do not have any saved quotes." %}</p>
        {% else %}
            <form action="." method="post" id="saved_quotes_form">
            {% csrf_token %}
                <table class="table table-stiped" id="saved_quotes">
                    <tr class="quote-header">
                        <th>{% trans "Reference Number" %}</th>
                        <th>{% trans "Description" %}</th>
                        <th>{% trans "Total cost<br/>(without delivery)" %}</th>
                        <th class="quote-column-narrow">{% trans "Date created" %}</th>
                        <th class="quote-column-narrow">{% trans "Expiry date" %}</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>

                    {% for saved_quote in saved_quotes %}
                    <tr class="quote-quote" id="{{ saved_quote.id }}_row">
                        <td><a class="quote-ref-number" href="javascript:void(0);">#{{ saved_quote.reference_number }}</a></td>
                        <td></td>
                        <td class="quote-column-narrow">{{ saved_quote.total_price|floatformat:2 }}</td>
                        <td class="quote-column-narrow">{{ saved_quote.date_added }}</td>
                        <td class="quote-column-narrow">{{ saved_quote.date_expired }}</td>
                        <td class="quote-column-email">
                            <a href="/" class="quote-product-email"></a>
                        </td>
                        <td class="quote-column-delete">
                            <a href="/options/quote/{{ saved_quote.id }}/delete/" class="quote-product-delete"></a>
                        </td>
                        <td class="quote-column-order">
                            <button class="btn btn-primary btn-wide" type='submit' name='cancel_alert' value='{{ saved_quote.id }}'>{% trans "Order now" %}</button>
                        </td>
                        <td class="quote-column-toggle">
                            <a href="javascript:void(0);" class="quote-product-toggle quote-product-toggle-down"></a>
                        </td>
                    </tr>

                    <tr class="quote-product quote-product-header hidden" id="{{ saved_quote.id }}_header">
                        <td colspan="2"><strong>Product</strong></td>
                        <td colspan="5"><strong>Options</strong></td>
                        <td><strong>Quantity</strong></td>
                        <td><strong>Cost</strong></td>
                    </tr>

                    {% for quoteline in saved_quote.quoteline_set.all %}
                        {% if forloop.last %}
                            <tr class="quote-product quote-product-line quote-product-last hidden {{ saved_quote.id }}_product">
                        {% else %}
                            <tr class="quote-product quote-product-line hidden {{ saved_quote.id }}_product">
                        {% endif %}
                                <td colspan="2">
                                    {{ quoteline.product }}
                                </td>
                                <td colspan="5">
                                    {% for option in quoteline.choices.all %}
                                        {{ option }}
                                        <br/>
                                    {% endfor %}
                                </td>
                                <td>
                                    {{ quoteline.quantity }}
                                </td>
                                <td>
                                    {{ quoteline.price_incl_tax }}
                                </td>
                            </tr>
                    {% endfor %}

                    {% endfor %}

                </table>
            </form>
        {% endif %}
        {% endblock %}
    </div>

    {% block extra_tabs %}
    {% endblock %}

    <script type="text/javascript">
      $(function() {
        PPS.accounts.init();
      });
    </script>
</div>
<!--End of tab-content -->

{% endblock content %}

{% block extrascripts %}
    {% include "customer/partials/extrascripts.html" %}
    {{ block.super }}
{% endblock %}

{% block onbodyload %}
oscar.account.init();
{% endblock %}
